{"ast":null,"code":"import axios from \"axios\";\nimport { setAlert } from \"./alert\";\nimport { GET_LOADS, GET_LOAD, LOAD_ERROR, ADD_LOAD, PATCH_PICKUP, PICKUP_ERROR, PATCH_DROP, DROP_ERROR, DELETE_LOAD, DELETE_LOAD_ERROR, UPDATE_LOAD, UPDATE_LOAD_ERROR, LOAD_DOC_DELETE, LOAD_DOC_UPLOAD, RETURNED_SEARCHED_LOADS, RESET_SEARCHED_LOADS, INVOICE_CREATED, SELECT_LOAD, INVOICE_LOAD_FETCHED, MERGE_LOAD_DOCS, RESET_INVOICE_GENERATED } from \"./types\";\nimport { proxy } from \"../../package.json\"; // Get current users loads\n\nexport const getLoads = (page = 0, limit = 15, module = '') => async dispatch => {\n  try {\n    axios.defaults.headers.common['x-auth-token'] = localStorage.token;\n    const url = `/api/load/me?page=${page + 1}&limit=${limit}&module=${module}`;\n    const res = await axios.get(url);\n    dispatch({\n      type: GET_LOADS,\n      payload: {\n        loads: res.data,\n        page,\n        limit\n      }\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const getInvoiceLoads = (page = 0, limit = 5, search = '') => async dispatch => {\n  try {\n    const url = `/api/load/invoice_loads?page=${page + 1}&limit=${limit}&search=${search}`;\n    const response = await axios.get(url);\n    const {\n      loads,\n      total,\n      totalPages\n    } = response.data;\n    dispatch({\n      type: INVOICE_LOAD_FETCHED,\n      payload: {\n        invoices: loads,\n        page,\n        limit,\n        search,\n        total,\n        totalPages\n      }\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const deleteLoadDocument = (load_id, doc_type, doc_name) => async dispatch => {\n  try {\n    const url = `/api/load/remove/doc/${load_id}/${doc_type}/${doc_name}`;\n    await axios.delete(url);\n    dispatch({\n      type: LOAD_DOC_DELETE,\n      payload: {\n        load_id,\n        doc_type\n      }\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const uploadLoadDocument = (load_id, doc_type, documents) => async dispatch => {\n  try {\n    const url = `/api/load/upload/load/${load_id}/${doc_type}`;\n    const form = new FormData();\n\n    for (let doc of documents) form.append(doc_type, doc);\n\n    const response = await axios.patch(url, form);\n    const {\n      file_data\n    } = response.data;\n    dispatch({\n      type: LOAD_DOC_UPLOAD,\n      payload: {\n        file_data,\n        load_id,\n        doc_type\n      }\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const generateInvoice = (load_id, data) => async dispatch => {\n  try {\n    await axios.post(\"/api/invoice\", {\n      load_id,\n      ...data\n    });\n    dispatch({\n      type: INVOICE_CREATED,\n      payload: {\n        load_id\n      }\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const searchLoads = (page = 0, limit = 15, search = '', module = '') => async dispatch => {\n  try {\n    const url = `/api/load/me?page=${page + 1}&limit=15&search=${search}&module=${module}`;\n    const res = await axios.get(url);\n    dispatch({\n      type: RETURNED_SEARCHED_LOADS,\n      payload: {\n        data: res.data,\n        page,\n        limit,\n        search\n      }\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const resetLoadsSearch = (listBarType = '') => async (dispatch, getState) => {\n  dispatch({\n    type: RESET_SEARCHED_LOADS\n  });\n  const {\n    load: {\n      page,\n      rowsPerPage\n    }\n  } = getState();\n  dispatch(getLoads(+page, +rowsPerPage, listBarType));\n};\nexport const selectLoad = (input = null) => ({\n  type: SELECT_LOAD,\n  payload: input\n}); // Get post\n\nexport const getLoad = id => async dispatch => {\n  try {\n    const res = await axios.get(`/loads/${id}`);\n    dispatch({\n      type: GET_LOAD,\n      payload: res.data\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n}; //add load\n\nexport const addLoad = formData => async dispatch => {\n  try {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    console.log('=========================  LOADINF...............');\n    const res = await axios.post(\"/api/load\", formData, config);\n    dispatch({\n      type: ADD_LOAD,\n      payload: res.data\n    });\n    dispatch(setAlert(\"Load Created\", \"success\"));\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const updateLoad = (formData, module = '') => async (dispatch, getState) => {\n  try {\n    const form = new FormData();\n\n    for (let key of Object.keys(formData)) {\n      if (['rateConfirmation', 'proofDelivery'].indexOf(key) < 0) {\n        const data = formData[key];\n        const isArray = Array.isArray(data);\n        const isNull = data === null;\n        let dataToSend = isArray && !isNull ? JSON.stringify(data) : data;\n        form.append(key, dataToSend);\n      }\n    }\n\n    for (let key of ['rateConfirmation', 'proofDelivery']) {\n      const files = formData[key];\n      if (files) for (let file of files) form.append(key, file);\n    }\n\n    await axios.patch(\"/api/load/modify\", form);\n    const {\n      load: {\n        search: {\n          page,\n          limit,\n          query\n        }\n      }\n    } = getState();\n    if (!query) dispatch(getLoads(0, 5, module));else dispatch(searchLoads(page, limit, query));\n    dispatch(setAlert(\"Load Updated\", \"success\"));\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const downloadDocuments = file_name => {\n  axios({\n    url: proxy + \"/api/load/download/\" + file_name,\n    method: \"GET\",\n    responseType: 'blob'\n  }).then(res => {\n    const parts = res.config.url.split('/');\n    const name = parts[parts.length - 1];\n    const url = window.URL.createObjectURL(new Blob([res.data]));\n    const link = document.createElement('a');\n    link.href = url;\n    link.setAttribute('download', name);\n    document.body.appendChild(link);\n    link.click();\n  });\n}; //add pickup\n//patch pickup\n\nexport const patchPickup = (load_id, pickup) => async dispatch => {\n  try {\n    const res = await axios.patch(`/api/load/pickup?load_id=${load_id}`, pickup);\n    dispatch({\n      type: PATCH_PICKUP,\n      payload: res.data\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n}; //patch drop\n\nexport const patchDrop = (load_id, drop) => async dispatch => {\n  try {\n    const res = await axios.patch(`/api/load/drop?load_id=${load_id}`, drop);\n    dispatch({\n      type: PATCH_DROP,\n      payload: res.date\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n}; // Delete a load\n\nexport const deleteLoad = load_id => async dispatch => {\n  try {\n    const res = await axios.delete(`/api/load`, {\n      data: {\n        load_id: load_id\n      }\n    });\n    console.log(\"RES:                 \", res);\n    dispatch({\n      type: DELETE_LOAD,\n      payload: load_id\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const mergeDocuments = (data, headers) => async dispatch => {\n  try {\n    const res = await axios.post(`${proxy}/api/load/invoice/merge_docs`, data, headers);\n    console.log('Response :', res);\n    dispatch({\n      type: MERGE_LOAD_DOCS,\n      payload: res.data\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\nexport const resetInvoiceGenerated = () => async dispatch => {\n  try {\n    dispatch({\n      type: RESET_INVOICE_GENERATED,\n      payload: null\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};","map":{"version":3,"sources":["/Users/sunnygill/Dropbox/My Mac (Surinders-MacBook-Pro.local)/Desktop/freightdokFrontend/client/src/actions/load.js"],"names":["axios","setAlert","GET_LOADS","GET_LOAD","LOAD_ERROR","ADD_LOAD","PATCH_PICKUP","PICKUP_ERROR","PATCH_DROP","DROP_ERROR","DELETE_LOAD","DELETE_LOAD_ERROR","UPDATE_LOAD","UPDATE_LOAD_ERROR","LOAD_DOC_DELETE","LOAD_DOC_UPLOAD","RETURNED_SEARCHED_LOADS","RESET_SEARCHED_LOADS","INVOICE_CREATED","SELECT_LOAD","INVOICE_LOAD_FETCHED","MERGE_LOAD_DOCS","RESET_INVOICE_GENERATED","proxy","getLoads","page","limit","module","dispatch","defaults","headers","common","localStorage","token","url","res","get","type","payload","loads","data","err","message","getInvoiceLoads","search","response","total","totalPages","invoices","deleteLoadDocument","load_id","doc_type","doc_name","delete","uploadLoadDocument","documents","form","FormData","doc","append","patch","file_data","generateInvoice","post","searchLoads","resetLoadsSearch","listBarType","getState","load","rowsPerPage","selectLoad","input","getLoad","id","addLoad","formData","config","console","log","updateLoad","key","Object","keys","indexOf","isArray","Array","isNull","dataToSend","JSON","stringify","files","file","query","downloadDocuments","file_name","method","responseType","then","parts","split","name","length","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","patchPickup","pickup","patchDrop","drop","date","deleteLoad","mergeDocuments","resetInvoiceGenerated"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { setAlert } from \"./alert\";\nimport { \nGET_LOADS, \nGET_LOAD, \nLOAD_ERROR, \nADD_LOAD, \nPATCH_PICKUP, \nPICKUP_ERROR, \nPATCH_DROP, \nDROP_ERROR, \nDELETE_LOAD, \nDELETE_LOAD_ERROR, \nUPDATE_LOAD, \nUPDATE_LOAD_ERROR,\nLOAD_DOC_DELETE,\nLOAD_DOC_UPLOAD,\nRETURNED_SEARCHED_LOADS,\nRESET_SEARCHED_LOADS,\nINVOICE_CREATED,\nSELECT_LOAD,\nINVOICE_LOAD_FETCHED,\nMERGE_LOAD_DOCS,\nRESET_INVOICE_GENERATED\n} from \"./types\";\n\nimport { proxy } from \"../../package.json\";\n\n// Get current users loads\nexport const getLoads = (page = 0, limit = 15, module = '') => async (dispatch) => {\n  try {\n    axios.defaults.headers.common['x-auth-token'] = localStorage.token;\n    const url = `/api/load/me?page=${page+1}&limit=${limit}&module=${module}`;\n    const res = await axios.get(url);\n    dispatch({\n      type: GET_LOADS,\n      payload: { loads: res.data, page, limit },\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\n\nexport const getInvoiceLoads = (page = 0, limit = 5, search = '') => async dispatch => {\n  try {\n    const url = `/api/load/invoice_loads?page=${page+1}&limit=${limit}&search=${search}`;\n    const response = await axios.get(url);\n    const { loads, total, totalPages } = response.data;\n    dispatch({\n      type: INVOICE_LOAD_FETCHED,\n      payload: { invoices: loads, page, limit, search, total, totalPages }\n    })\n  } catch (err) { dispatch(setAlert(err.message, \"error\")); }\n}\n\nexport const deleteLoadDocument = (load_id, doc_type, doc_name) => async dispatch => {\n  try {\n    const url = `/api/load/remove/doc/${load_id}/${doc_type}/${doc_name}`;\n    await axios.delete(url);\n    dispatch({\n      type: LOAD_DOC_DELETE,\n      payload: { load_id, doc_type }\n    });\n  } catch (err) { dispatch(setAlert(err.message, \"error\")); }\n};\n\nexport const uploadLoadDocument = (load_id, doc_type, documents) => async dispatch => {\n  try {\n    const url = `/api/load/upload/load/${load_id}/${doc_type}`;\n    const form = new FormData();\n    for (let doc of documents)\n      form.append(doc_type, doc);\n    const response = await axios.patch(url, form);\n    const { file_data } = response.data;\n    dispatch({\n      type: LOAD_DOC_UPLOAD,\n      payload: { file_data, load_id, doc_type }\n    });\n  } catch (err) { dispatch(setAlert(err.message, \"error\")); }\n}\n\nexport const generateInvoice = (load_id, data) => async dispatch => {\n  try {\n    await axios.post(\"/api/invoice\", {\n      load_id,\n      ...data\n    });\n    dispatch({\n      type: INVOICE_CREATED,\n      payload: { load_id }\n    });\n  } catch (err) { dispatch(setAlert(err.message, \"error\")); }\n}\n\nexport const searchLoads = (page = 0, limit = 15, search = '', module = '') => async dispatch => {\n  try {\n    const url = `/api/load/me?page=${page+1}&limit=15&search=${search}&module=${module}`;\n    const res = await axios.get(url);\n    dispatch({\n      type: RETURNED_SEARCHED_LOADS,\n      payload: { data: res.data, page, limit, search },\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n}\n\nexport const resetLoadsSearch = (listBarType = '') => async (dispatch, getState) => {\n  dispatch({type: RESET_SEARCHED_LOADS});\n  const { load: { page, rowsPerPage } } = getState();\n  dispatch(getLoads(+page, +rowsPerPage, listBarType));\n};\n\nexport const selectLoad = (input = null) => ({\n  type: SELECT_LOAD,\n  payload: input\n});\n\n// Get post\nexport const getLoad = (id) => async (dispatch) => {\n  try {\n    const res = await axios.get(`/loads/${id}`);\n\n    dispatch({\n      type: GET_LOAD,\n      payload: res.data,\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\n\n//add load\nexport const addLoad = (formData) => async (dispatch) => {\n  try {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    };\n    console.log('=========================  LOADINF...............');\n    const res = await axios.post(\"/api/load\", formData, config);\n\n    dispatch({\n      type: ADD_LOAD,\n      payload: res.data,\n    });\n\n    dispatch(setAlert(\"Load Created\", \"success\"));\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\n\nexport const updateLoad = (formData, module = '') => async (dispatch, getState) => {\n  try {\n    const form = new FormData();\n    for (let key of Object.keys(formData)) {\n      if (['rateConfirmation', 'proofDelivery'].indexOf(key) < 0) {\n        const data = formData[key];\n        const isArray = Array.isArray(data);\n        const isNull = data === null;\n        let dataToSend = isArray && !isNull ? JSON.stringify(data) : data;\n        form.append(key, dataToSend);\n      }\n    }\n    for (let key of ['rateConfirmation', 'proofDelivery']) {\n      const files = formData[key];\n      if (files)\n        for (let file of files)\n          form.append(key, file);\n    }\n    await axios.patch(\"/api/load/modify\", form);\n    const { load: { search: { page, limit, query } } } = getState();\n    if (!query)\n      dispatch(getLoads(0, 5, module));\n    else\n      dispatch(searchLoads(page, limit, query));\n    dispatch(setAlert(\"Load Updated\", \"success\"));\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n}\n\nexport const downloadDocuments = (file_name) => {\n  axios({\n    url: proxy + \"/api/load/download/\" + file_name,\n    method: \"GET\",\n    responseType: 'blob'\n  })\n  .then(res => {\n    const parts = res.config.url.split('/');\n    const name = parts[parts.length - 1];\n    const url = window.URL.createObjectURL(new Blob([res.data]))\n    const link = document.createElement('a')\n    link.href = url\n    link.setAttribute('download', name);\n    document.body.appendChild(link);\n    link.click()\n  });\n}\n\n//add pickup\n\n//patch pickup\nexport const patchPickup = (load_id, pickup) => async (dispatch) => {\n  try {\n    const res = await axios.patch(`/api/load/pickup?load_id=${load_id}`, pickup);\n    dispatch({\n      type: PATCH_PICKUP,\n      payload: res.data,\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\n\n//patch drop\nexport const patchDrop = (load_id, drop) => async (dispatch) => {\n  try {\n    const res = await axios.patch(`/api/load/drop?load_id=${load_id}`, drop);\n    dispatch({\n      type: PATCH_DROP,\n      payload: res.date,\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\n\n// Delete a load\nexport const deleteLoad = (load_id) => async (dispatch) => {\n  try {\n    const res = await axios.delete(`/api/load`, { data: { load_id: load_id } });\n    console.log(\"RES:                 \", res);\n    dispatch({\n      type: DELETE_LOAD,\n      payload: load_id,\n    });\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n};\n\nexport const mergeDocuments = (data, headers) => async (dispatch) => {\n  try {\n    const res = await axios.post(`${proxy}/api/load/invoice/merge_docs`, data, headers);\n    console.log('Response :', res);\n    dispatch({\n      type: MERGE_LOAD_DOCS,\n      payload: res.data\n    })\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n}\n\nexport const resetInvoiceGenerated = () => async (dispatch) => {\n  try {\n    dispatch({\n      type: RESET_INVOICE_GENERATED,\n      payload: null\n    })\n  } catch (err) {\n    dispatch(setAlert(err.message, \"error\"));\n  }\n}"]},"metadata":{},"sourceType":"module"}