(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[30],{1117:function(e,t,n){"use strict";n.r(t);var a=n(198),o=n(1006),i=n(0),s=n(43),r=(n(22),n(3)),l=n(27),c=n(56);const d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return async n=>{try{n({type:r.w});const{success:a,data:o}=await Object(c.b)({uri:"/api/users?page=".concat(e,"&limit=").concat(t)});a||Object(l.a)(o.message,"error"),n({type:r.y,payload:o||[]})}catch(a){n({type:r.x})}}},j=()=>({type:r.U});var b=n(270),u=n(1076),h=n(1144),m=n(1077),x=n(197),g=n(44),p=n(274),f=n(89),O=n(32),w=n(263),y=n(65),v=n(2);const C={email:"",password:"",role:"dispatch"};var S=()=>{const{mutation:e,loading:t}=Object(p.a)("/api/users"),[n,a]=Object(i.useState)({...C}),{loading:c,open:b,error:S,user:k,page:P,limit:I}=Object(s.e)((e=>e.users)),{mutation:D,loading:R}=Object(p.a)("/api/users/".concat(null===k||void 0===k?void 0:k._id)),{user:z={},allRoles:F}=Object(s.e)((e=>e.auth)),{roles:A=[]}=Object(s.e)((e=>e.auth)),N=Object(s.d)(),[E,U]=Object(i.useState)(),{add:_=!1}=y.a.getUserPermissionsByDashboardId("users");Object(i.useEffect)((()=>{if(null!==z&&void 0!==z&&z.role.equalsIgnoreCase(O.g.superadmin))U(A);else{const e=A.filter((e=>"driver"===e||"afterhours"===e||"load planner"===e||"support"===e||"dispatch"===e||"ownerOperator"===e));U(e)}}),[A]),Object(i.useEffect)((()=>{b||W()}),[b]),Object(i.useEffect)((()=>{0===+P&&b&&(W(),N(d(+P,+I)))}),[P]),Object(i.useEffect)((()=>{if(k){const{email:e,rolePermissionId:t}=k;a((n=>({...n,email:e,role:t}))),N(j())}}),[k]);const M=e=>{let{name:t,value:n}=e;a((e=>({...e,[t]:n})))},W=()=>{a({...C}),N({type:r.fb})};function H(e){let{success:t,data:n}=e;t?(W(),N(d(+P,+I)),Object(l.a)((k._id?"Updated ":"Saved ")+"Successfully")):Object(l.a)(n.message,"error")}return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(o.a,{color:"primary",variant:"contained",onClick:()=>{N(j())},disabled:!_,children:"Add User"}),Object(v.jsxs)(u.a,{fullWidth:!1,maxWidth:"md",open:b,onClose:W,"aria-labelledby":"form-dialog-title",PaperProps:{sx:{width:400}},children:[Object(v.jsxs)(m.a,{id:"form-dialog-title",sx:{textAlign:"center",color:g.a},children:[k?"Update":"Add"," User"]}),S?Object(v.jsx)("p",{style:{textAlign:"center"},children:S}):"",Object(v.jsx)(h.a,{sx:{p:0,overflow:"hidden"},children:Object(v.jsx)("div",{className:"",children:Object(v.jsx)("form",{noValidate:!0,onSubmit:async t=>{t.preventDefault();const{email:a,password:o,role:i}=n,{_id:s,roleName:r}=F.find((e=>e._id===i))||{};if(!c)if(k){const e=((e,t)=>{const n={},a=Object.keys(e);for(let o of a)"password"!==o&&t[o]!==e[o]&&(n[o]=e[o]),"password"===o&&e[o]&&(n[o]=e[o]);return n})(n,k);await D({...e,rolePermissionId:i,role:r},"put",H)}else{if(!(a&&o&&i))return alert("All fields are required");if(!Object(f.e)(a))return alert("Email is not valid");if(o.length<6)return alert("Please enter password with 6 or more characters");await e({...n,rolePermissionId:s,role:r},"",H)}},children:Object(v.jsxs)(x.a,{container:!0,spacing:2,direction:"column",sx:{p:3},children:[Object(v.jsx)(x.a,{item:!0,children:Object(v.jsx)(w.b,{name:"email",label:"Email",onChange:M,value:n.email,autoFocus:!0,fullWidth:!0})}),Object(v.jsx)(x.a,{item:!0,children:Object(v.jsx)(w.d,{name:"password",label:"Password",onChange:M,value:n.password,fullWidth:!0})}),Object(v.jsx)(x.a,{item:!0,children:Object(v.jsx)(w.e,{onChange:M,label:"Role",name:"role",value:n.role,options:F,labelKey:"roleName",valueKey:"_id"})}),Object(v.jsx)(x.a,{item:!0,xs:12,justifyContent:"center",display:"flex",children:Object(v.jsx)(w.c,{isLoading:t||R,className:"",type:"submit",variant:"contained",color:"primary",children:"Submit"})})]})})})})]})]})},k=n(283),P=n(292);const{delete:I,edit:D}=y.a.getUserPermissionsByDashboardId("users");t.default=()=>{const{list:e,loading:t,page:n=1,limit:l=10,total:c}=Object(s.e)((e=>e.users)),j=Object(s.d)(),u=e=>{let{success:t}=e;t&&j(d(+n,+l))};Object(i.useEffect)((()=>{j(d(+n,+l))}),[j]);const h={emptyMessage:"No Users found",page:n,count:c,limit:l,onPageChange:(e,t)=>{j(d(t,+l))},rowCellPadding:"normal",showRefresh:!0,onPageSizeChange:e=>{let{value:t}=e;j(d(1,t))},columns:[{id:"name",label:"Name",emptyState:"--",renderer:e=>{let{row:{name:t="",firstName:n,lastName:a}}=e;return t||"".concat(n||"--"," ").concat(a||"")}},{id:"email",label:"Email"},{id:"role",label:"Role",valueFormatter:P.a},{id:"actions",label:"Actions",renderer:e=>{let{row:{_id:t,email:n,role:a,rolePermissionId:s}={}}=e;return Object(v.jsxs)(i.Fragment,{children:[Object(v.jsx)(o.a,{variant:"contained",sx:{mr:1},disabled:!D,onClick:()=>{var e;j((e={_id:t,email:n,role:a,rolePermissionId:s},{type:r.ib,payload:e}))},children:"Update"}),Object(v.jsx)(o.a,{variant:"contained",disabled:!I,color:"error",onClick:Object(k.c)({message:"Are you sure you want to delete "+n+"?",uri:"/api/users/".concat(t),afterSuccessCb:u}),children:"Delete"})]})}}]},m=()=>Object(v.jsx)(a.a,{sx:{display:"flex",justifyContent:"flex-end"},children:Object(v.jsx)(S,{})});return Object(v.jsx)(i.Fragment,{children:Object(v.jsx)(b.a,{loading:t,data:e,config:h,onRefetch:()=>j(d(+n,+l)),actions:Object(v.jsx)(m,{})})})}},269:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(198),o=(n(0),n(199)),i=n(2);function s(e){return Object(i.jsx)(a.a,{sx:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center","& > * + *":{marginLeft:2}},children:Object(i.jsx)(o.a,{...e})})}},270:function(e,t,n){"use strict";var a=n(198),o=n(244),i=n(1152),s=n(1147),r=n(1153),l=n(491),c=n(293),d=n.n(c),j=n(1151),b=n(1150),u=n(1131),h=n(197),m=n(87),x=n(245),g=n(1149),p=n(300),f=n.n(p),O=n(1148),w=n(262),y=n.n(w),v=n(290),C=n.n(v),S=n(0),k=n.n(S),P=n(13),I=n(1102),D=n(9),R=n(263),z=n(2);const F=Object(D.a)(I.a)((e=>{let{theme:t}=e;return{"& .MuiPaginationItem-root":{[t.breakpoints.down("md")]:{height:"1.8rem",width:"1rem"}}}})),A=Object(D.a)(l.a)((e=>{let{theme:t}=e;return{[t.breakpoints.down("sm")]:{justifyContent:"center"},display:"flex",justifyContent:"space-between",flexWrap:"wrap","& .pageSizeSelect":{width:80}}}));var N=e=>{let{data:t=[],onPageChange:n,page:a=0,count:o=0,limit:i=1,onPageSizeChange:s}=e;const[r,c]=Object(S.useState)(0);Object(S.useEffect)((()=>{Array.isArray(t)&&c(t.length)}),[t]);return o<=5?null:Object(z.jsxs)(A,{direction:"row",alignItems:"center",children:[Object(z.jsxs)(m.a,{sx:{color:"#525F7F"},fontSize:12,children:["Showing ",r," of ",o," entries"]}),Object(z.jsxs)(l.a,{direction:"row",alignItems:"center",children:[Object(z.jsx)(R.e,{name:"pageSize",label:"",value:i,options:[{id:5,label:5},{id:10,label:10},{id:20,label:20},{id:50,label:50},{id:100,label:100}],className:"pageSizeSelect",onChange:e=>{let{value:t}=e;"function"===typeof s&&s({value:t})}}),Object(z.jsx)(F,{count:Math.ceil(o/i),color:"primary",variant:"contained",page:a,size:"medium",onChange:(e,t)=>{n&&n(e,+t)}})]})]})},E=n(269),U=n(289),_=n(89);const M=Object(D.a)(O.a)((e=>{let{theme:t}=e;return{[t.breakpoints.down("xs")]:{fontSize:12,padding:"0 8px"}}})),W=Object(D.a)(f.a)((e=>{let{theme:t}=e;return{[t.breakpoints.down("xs")]:{fontSize:14}}}));function H(e){let{columns:t=[],config:n={},role:a}=e;const{headerCellSx:o={},hasDelete:i}=n,s=Object(S.useMemo)((()=>t.map(((e,t)=>{const{label:n="",id:i="",visible:s=!0}=e||{};return(y.a.isFunction(s)?s({column:e,role:a}):s)?Object(z.jsx)(M,{padding:"normal",sx:{color:"#000",bgcolor:"#fafafa",fontWeight:800,...o},children:n},i||t):null}))),[t,o]);return Object(z.jsxs)(g.a,{children:[s,i&&Object(z.jsx)(M,{padding:"none",sx:{...o}})]})}const K=e=>{let{columns:t,data:n=[],config:a={},handleRowClick:o,handleDelete:i,...s}=e;return(n||[]).map(((e,n)=>{const{dataKey:r=""}=a;return r&&(e=e[r]),(e=>{let{row:t=[],columns:n={},config:a={},handleRowClick:o,rowIndex:i,handleDelete:s,hasDeletePermission:r,...l}=e;const{hasDelete:c=!1,rowCellPadding:d="none",onRowClick:j,rowStyleCb:b}=a,{role:u}=l;let h={};b&&(h=b({row:t})||{});const m=Object(z.jsx)(M,{sx:{},padding:"none",component:"th",scope:"row",children:Object(z.jsx)(x.a,{onClick:s.bind(void 0,t._id,t),disabled:!r,children:Object(z.jsx)(W,{color:"error"})})}),p=n.map(((e,n)=>{const{id:a="",renderer:o,emptyState:s="--",valueFormatter:r,visible:l=!0}=e||{};if(!(y.a.isFunction(l)?l({column:e,role:u}):l))return null;let c;return c=r&&y.a.isFunction(r)?r(t[a]):y.a.isFunction(o)?o({row:t,role:u},i)||s:y.a.get(t,a,s)||s,Object(z.jsx)(M,{padding:d||"normal",component:"th",scope:"row",children:c},a+n)}));return Object(z.jsxs)(g.a,{hover:!!j,onClick:e=>{e.preventDefault(),y.a.isFunction(o)&&o(t)},sx:j?{cursor:"pointer",...h}:{...h},children:[p,c&&m]},i)})({row:e,columns:t,config:a,handleRowClick:o,rowIndex:n,handleDelete:i,...s})}))},T=e=>{let{config:t={},data:n=[],history:c,loading:g=!1,onRefetch:p,isRefetching:f,actions:O}=e;n=n||[];const[w,v]=Object(S.useState)({}),[P,I]=Object(S.useState)({open:!1,config:{}}),{columns:D=[],onRowClick:R,hasOnClickUrl:F=!0,onPageChange:A,page:M,count:W,limit:T,onPageSizeChange:q,size:B="medium",emptyMessage:J="",onRowClickDataCallback:L,showRefresh:V=!1,onDelete:G,deleteMessage:Q,deletePermissions:X=[],containerHeight:Y=""}=t,{role:Z=""}=Object(_.d)().user,$="boolean"===typeof X?X:X.indexOf(Z)>-1||!1,ee=k.a.useRef([]),te=Array.isArray(n)&&n.length,ne=Object(S.useMemo)((()=>O&&k.a.isValidElement(O)?O:Object(z.jsx)(z.Fragment,{})),[]),ae=e=>{if(F&&R){const t=R(e);L&&(e=L(e)),c.push(t,e)}else R&&R(e)},oe=(e,t,n)=>{n.stopPropagation();const a={title:()=>Object(z.jsxs)(h.a,{container:!0,alignItems:"center",sx:{p:"16px 24px"},gap:1,children:[Object(z.jsx)(C.a,{color:"error"}),Object(z.jsx)(m.a,{sx:{fontSize:"1.25rem",fontWeight:550},color:"error",children:"Delete"})]}),okText:"Delete",onOk:()=>G(e,ie,{row:t}),content:()=>Object(z.jsx)(u.a,{sx:{color:"#000"},children:y.a.isFunction(Q)?Q({row:t}):Q||"Are you sure you want to delete the record?"})};I({...P,open:!0,config:a})};function ie(){I({...P,open:!1})}const se=Object(S.useMemo)((()=>te?Object(z.jsxs)(S.Fragment,{children:[Object(z.jsx)(b.a,{className:"",sx:{backgroundColor:"#fafafa",borderTop:"1px solid rgba(224, 224, 224, 1)"},children:Object(z.jsx)(H,{columns:D,config:t,role:Z})}),Object(z.jsx)(j.a,{children:Object(z.jsx)(K,{role:Z,columns:D,data:n,config:t,handleRowClick:ae,handleDelete:oe,hasDeletePermission:$},Date.now())})]}):Object(z.jsx)("tbody",{style:{height:300},children:Object(z.jsx)("tr",{children:Object(z.jsx)("td",{style:{textAlign:"center"},children:Object(z.jsx)("h4",{children:J||"No records found"})})})})),[n,t]);return Object(S.useEffect)((()=>{var e;if(null!==ee&&void 0!==ee&&null!==(e=ee.current)&&void 0!==e&&e.table){const e=ee.current.table.offsetHeight;v({...w,height:e>200?e:void 0})}}),[]),Object(z.jsxs)(a.a,{className:"enhanced-table",sx:{height:te&&!g?Y||"95%":"auto"},children:[Object(z.jsxs)(l.a,{alignItems:"flex-end",justifyContent:"flex-end",direction:"row",py:1,gap:.5,children:[ne,V&&Object(z.jsx)(x.a,{title:"Refresh",onClick:p,children:Object(z.jsx)(d.a,{className:f?"rotateIcon":void 0})})]}),Object(z.jsxs)(i.a,{component:o.a,className:"",sx:{boxShadow:"0px 0px 32px #8898AA26",mb:2,height:te&&!g?"calc(100% - 80px)":"auto",position:"relative"},children:[g?(()=>{const e=window.innerHeight-180,t=(w.height?w.height>e?e:w.height:e)||e;return Object(z.jsx)(h.a,{container:!0,alignItems:"center",justifyContent:"center",sx:{height:t},children:Object(z.jsx)(h.a,{item:!0,alignItems:"center",sx:{position:"relative"},children:Object(z.jsx)(E.a,{})})})})():Object(z.jsx)(r.a,{ref:e=>ee.current.table=e,"aria-label":"caption table",size:B,stickyHeader:!0,children:se}),Object(z.jsx)(s.a,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,position:"absolute"},open:f||!1,children:Object(z.jsx)(E.a,{sx:{color:"inherit"}})})]}),!g&&n.length>0&&Object(z.jsx)(N,{data:n,onPageChange:A,page:M,count:W,limit:T,onPageSizeChange:q}),Object(z.jsx)(U.a,{className:"enhancedTable_dialog",open:P.open,config:P.config,onClose:ie})]})};t.a=Object(P.withRouter)(Object(S.memo)(T))}}]);
//# sourceMappingURL=30.2a671a8f.chunk.js.map