(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[29],{1118:function(e,t,n){"use strict";n.r(t);var a=n(200),c=n(1006),r=n(0),o=n(43),s=(n(22),n(3)),i=n(25),l=n(56);const d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return async n=>{try{n({type:s.w});const{success:a,data:c}=await Object(l.b)({uri:"/api/users?page=".concat(e+1,"&limit=").concat(t)});a||Object(i.a)(c.message,"error"),n({type:s.y,payload:c||[]})}catch(a){n({type:s.x})}}},j=()=>({type:s.U});var u=n(270),b=n(1077),h=n(1145),m=n(1078),p=n(199),x=n(363),g=n(44),O=n(277),f=n(88),w=n(31),y=n(271),C=n(2);const v={email:"",password:"",role:"dispatch"};var k=()=>{const{mutation:e,loading:t}=Object(O.a)("/api/users"),[n,a]=Object(r.useState)({...v}),{loading:l,open:u,error:k,user:S,page:D,limit:P}=Object(o.e)((e=>e.users)),{mutation:R,loading:A}=Object(O.a)("/api/users/".concat(null===S||void 0===S?void 0:S._id)),{user:F={}}=Object(o.e)((e=>e.auth)),{roles:N=[]}=Object(o.e)((e=>e.auth)),E=Object(o.d)(),[I,U]=Object(r.useState)();Object(r.useEffect)((()=>{if(null!==F&&void 0!==F&&F.role.equalsIgnoreCase(w.g.superadmin))U(N);else{const e=N.filter((e=>"driver"===e||"afterhours"===e||"load planner"===e||"support"===e||"dispatch"===e||"ownerOperator"===e));U(e)}}),[N]),Object(r.useEffect)((()=>{u||z()}),[u]),Object(r.useEffect)((()=>{0===+D&&u&&(z(),E(d(+D,+P)))}),[D]),Object(r.useEffect)((()=>{if(S){const{email:e,role:t}=S;a((n=>({...n,email:e,role:t}))),E(j())}}),[S]);const M=e=>{let{name:t,value:n}=e;a((e=>({...e,[t]:n})))},z=()=>{a({...v}),E({type:s.fb})};function W(e){let{success:t,data:n}=e;t?(z(),E(d(+D,+P)),Object(i.a)((S._id?"Updated ":"Saved ")+"Successfully")):Object(i.a)(n.message,"error")}return Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(c.a,{color:"primary",variant:"contained",onClick:()=>{E(j())},children:"Add User"}),Object(C.jsxs)(b.a,{fullWidth:!1,maxWidth:"md",open:u,onClose:z,"aria-labelledby":"form-dialog-title",PaperProps:{sx:{width:400}},children:[Object(C.jsxs)(m.a,{id:"form-dialog-title",sx:{textAlign:"center",color:g.a},children:[S?"Update":"Add"," User"]}),k?Object(C.jsx)("p",{style:{textAlign:"center"},children:k}):"",Object(C.jsx)(h.a,{sx:{p:0,overflow:"hidden"},children:Object(C.jsx)("div",{className:"",children:Object(C.jsx)("form",{noValidate:!0,onSubmit:async t=>{if(t.preventDefault(),!l)if(S){const e=((e,t)=>{const n={},a=Object.keys(e);for(let c of a)"password"!==c&&t[c]!==e[c]&&(n[c]=e[c]),"password"===c&&e[c]&&(n[c]=e[c]);return n})(n,S);await R(e,"put",W)}else{const{email:t,password:a,role:c}=n;if(!(t&&a&&c))return alert("All fields are required");if(!Object(f.e)(t))return alert("Email is not valid");if(a.length<6)return alert("Please enter password with 6 or more characters");await e(n,"",W)}},children:Object(C.jsxs)(p.a,{container:!0,spacing:2,direction:"column",sx:{p:3},children:[Object(C.jsx)(p.a,{item:!0,children:Object(C.jsx)(y.b,{name:"email",label:"Email",onChange:M,value:n.email,autoFocus:!0,fullWidth:!0})}),Object(C.jsx)(p.a,{item:!0,children:Object(C.jsx)(y.d,{name:"password",label:"Password",onChange:M,value:n.password,fullWidth:!0})}),Object(C.jsx)(p.a,{item:!0,children:Object(C.jsx)(y.e,{onChange:M,label:"Role",name:"role",value:n.role,options:I&&I.map((e=>({id:e,label:Object(x.a)(e)})))})}),Object(C.jsx)(p.a,{item:!0,xs:12,justifyContent:"center",display:"flex",children:Object(C.jsx)(y.c,{isLoading:t||A,className:"",type:"submit",variant:"contained",color:"primary",children:"Submit"})})]})})})})]})]})},S=n(287);t.default=()=>{const{list:e,loading:t,page:n=0,limit:i=5,total:l}=Object(o.e)((e=>e.users)),{user:j}=Object(o.e)((e=>e.auth)),b=Object(o.d)(),h=e=>{let{success:t}=e;t&&b(d(+n,+i))};Object(r.useEffect)((()=>{b(d(+n,+i))}),[b]);const m=[w.g.dispatch,w.g.admin,w.g.superadmin],p={emptyMessage:"No Users found",page:n,count:l,limit:i,onPageChange:(e,t)=>{b(d(t-1,+i))},rowCellPadding:"normal",showRefresh:!0,columns:[{id:"name",label:"Name",emptyState:"--",renderer:e=>{let{row:{name:t="",firstName:n,lastName:a}}=e;return t||"".concat(n||"--"," ").concat(a||"")}},{id:"email",label:"Email"},{id:"role",label:"Role"},{id:"actions",label:"Actions",renderer:e=>{let{row:{_id:t,email:n,role:a}={},role:o}=e;return Object(C.jsxs)(r.Fragment,{children:[m.includes(o)&&Object(C.jsx)(c.a,{variant:"contained",sx:{mr:1},onClick:()=>{b((e=>({type:s.ib,payload:e}))({_id:t,email:n,role:a}))},children:"Update"}),j&&[w.g.admin,w.g.superadmin].includes(j.role)&&Object(C.jsx)(c.a,{variant:"contained",color:"error",onClick:Object(S.c)({message:"Are you sure you want to delete "+n+"?",uri:"/api/users/".concat(t),afterSuccessCb:h}),children:"Delete"})]})}}]},x=()=>Object(C.jsx)(a.a,{sx:{display:"flex",justifyContent:"flex-end"},children:Object(C.jsx)(k,{})});return Object(C.jsx)(r.Fragment,{children:Object(C.jsx)(u.a,{loading:t,data:e,config:p,onRefetch:()=>b(d(+n,+i)),actions:Object(C.jsx)(x,{})})})}},270:function(e,t,n){"use strict";var a=n(200),c=n(246),r=n(1152),o=n(1153),s=n(493),i=n(292),l=n.n(i),d=n(1151),j=n(1150),u=n(1132),b=n(199),h=n(86),m=n(247),p=n(1149),x=n(295),g=n.n(x),O=n(1148),f=n(261),w=n.n(f),y=n(282),C=n.n(y),v=n(0),k=n.n(v),S=n(13),D=n(1103),P=n(9),R=n(2);const A=Object(P.a)(D.a)((e=>{let{theme:t}=e;return{"& .MuiPaginationItem-root":{[t.breakpoints.down("md")]:{height:"1.8rem",width:"1rem"}}}})),F=Object(P.a)(s.a)((e=>{let{theme:t}=e;return{[t.breakpoints.down("sm")]:{justifyContent:"center"},display:"flex",justifyContent:"space-between",flexWrap:"wrap"}}));var N=e=>{let{data:t=[],onPageChange:n,page:a=0,count:c=0,limit:r=1}=e;const[o,s]=Object(v.useState)(0);Object(v.useEffect)((()=>{Array.isArray(t)&&s(t.length)}),[t]);return o<10&&c<10?null:Object(R.jsxs)(F,{direction:"row",alignItems:"center",children:[c>10&&Object(R.jsxs)(h.a,{sx:{color:"#525F7F"},fontSize:12,children:["Showing ",t.length," of ",c," entries"]}),t.length!==c&&Object(R.jsx)(A,{count:Math.ceil(c/r),color:"primary",variant:"contained",page:a+1,size:"medium",onChange:(e,t)=>{n&&n(e,t)}})]})},E=n(201);function I(){return Object(R.jsx)(a.a,{sx:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center","& > * + *":{marginLeft:2}},children:Object(R.jsx)(E.a,{})})}var U=n(288),M=n(88);const z=Object(P.a)(O.a)((e=>{let{theme:t}=e;return{[t.breakpoints.down("xs")]:{fontSize:12,padding:"0 8px"}}})),W=Object(P.a)(g.a)((e=>{let{theme:t}=e;return{[t.breakpoints.down("xs")]:{fontSize:14}}}));function _(e){let{columns:t=[],config:n={},role:a}=e;const{headerCellSx:c={},hasDelete:r}=n,o=Object(v.useMemo)((()=>t.map(((e,t)=>{const{label:n="",id:r="",visible:o=!0}=e||{};return(w.a.isFunction(o)?o({column:e,role:a}):o)?Object(R.jsx)(z,{padding:"normal",sx:{color:"#000",bgcolor:"#fafafa",fontWeight:800,...c},children:n},r||t):null}))),[t,c]);return Object(R.jsxs)(p.a,{children:[o,r&&Object(R.jsx)(z,{padding:"none",sx:{...c}})]})}const H=e=>{let{columns:t,data:n=[],config:a={},handleRowClick:c,handleDelete:r,...o}=e;return(n||[]).map(((e,n)=>{const{dataKey:s=""}=a;return s&&(e=e[s]),(e=>{let{row:t=[],columns:n={},config:a={},handleRowClick:c,rowIndex:r,handleDelete:o,hasDeletePermission:s,...i}=e;const{hasDelete:l=!1,rowCellPadding:d="none",onRowClick:j,rowStyleCb:u}=a,{role:b}=i;let h={};u&&(h=u({row:t})||{});const x=Object(R.jsx)(z,{sx:{},padding:"none",component:"th",scope:"row",children:Object(R.jsx)(m.a,{onClick:o.bind(void 0,t._id,t),disabled:!s,children:Object(R.jsx)(W,{color:"error"})})}),g=n.map(((e,n)=>{const{id:a="",renderer:c,emptyState:o="",valueFormatter:s,visible:i=!0}=e||{};if(!(w.a.isFunction(i)?i({column:e,role:b}):i))return null;let l;return l=s&&w.a.isFunction(s)?s(t[a]):w.a.isFunction(c)?c({row:t,role:b},r)||o:w.a.isObject(t)?w.a.get(t,a,o):t[a]||o,Object(R.jsx)(z,{padding:d||"normal",component:"th",scope:"row",children:l},a+n)}));return Object(R.jsxs)(p.a,{hover:!!j,onClick:e=>{e.preventDefault(),w.a.isFunction(c)&&c(t)},sx:j?{cursor:"pointer",...h}:{...h},children:[g,l&&x]},r)})({row:e,columns:t,config:a,handleRowClick:c,rowIndex:n,handleDelete:r,...o})}))},T=e=>{let{config:t={},data:n=[],history:i,loading:p=!1,onRefetch:x,isRefetching:g,actions:O}=e;n=n||[];const[f,w]=Object(v.useState)({}),[y,S]=Object(v.useState)({open:!1,config:{}}),{columns:D=[],onRowClick:P,hasOnClickUrl:A=!0,onPageChange:F,page:E,count:z,limit:W,size:T="medium",emptyMessage:q="",onRowClickDataCallback:J,showRefresh:L=!1,onDelete:V,deleteMessage:K,deletePermissions:B=[],containerHeight:G=""}=t,{role:Q=""}=Object(M.d)().user,X=B.indexOf(Q)>-1||!1,Y=k.a.useRef([]),Z=Array.isArray(n)&&n.length,$=Object(v.useMemo)((()=>O&&k.a.isValidElement(O)?O:Object(R.jsx)(R.Fragment,{})),[]),ee=e=>{if(A&&P){const t=P(e);J&&(e=J(e)),i.push(t,e)}else P&&P(e)},te=(e,t,n)=>{n.stopPropagation();const a={title:()=>Object(R.jsxs)(b.a,{container:!0,alignItems:"center",sx:{p:"16px 24px"},gap:1,children:[Object(R.jsx)(C.a,{color:"error"}),Object(R.jsx)(h.a,{sx:{fontSize:"1.25rem",fontWeight:550},color:"error",children:"Delete"})]}),okText:"Delete",onOk:()=>V(e,ne),content:()=>Object(R.jsx)(u.a,{sx:{color:"#000"},children:K||"Are you sure you want to delete the record?"})};S({...y,open:!0,config:a})};function ne(){S({...y,open:!1})}const ae=Object(v.useMemo)((()=>Z?Object(R.jsxs)(v.Fragment,{children:[Object(R.jsx)(j.a,{className:"",sx:{backgroundColor:"#fafafa",borderTop:"1px solid rgba(224, 224, 224, 1)"},children:Object(R.jsx)(_,{columns:D,config:t,role:Q})}),Object(R.jsx)(d.a,{children:Object(R.jsx)(H,{role:Q,columns:D,data:n,config:t,handleRowClick:ee,handleDelete:te,hasDeletePermission:X},Date.now())})]}):Object(R.jsx)("tbody",{style:{height:300},children:Object(R.jsx)("tr",{children:Object(R.jsx)("td",{style:{textAlign:"center"},children:Object(R.jsx)("h4",{children:q||"No records found"})})})})),[n,t]);return Object(v.useEffect)((()=>{var e;if(null!==Y&&void 0!==Y&&null!==(e=Y.current)&&void 0!==e&&e.table){const e=Y.current.table.offsetHeight;w({...f,height:e>200?e:void 0})}}),[]),Object(R.jsxs)(a.a,{className:"enhanced-table",sx:{height:Z&&!p?G||"95%":"auto"},children:[Object(R.jsxs)(s.a,{alignItems:"flex-end",justifyContent:"flex-end",direction:"row",py:1,gap:.5,children:[$,L&&Object(R.jsx)(m.a,{title:"Refresh",onClick:x,children:Object(R.jsx)(l.a,{className:g?"rotateIcon":void 0})})]}),Object(R.jsx)(r.a,{component:c.a,className:"",sx:{boxShadow:"0px 0px 32px #8898AA26",mb:2,height:Z&&!p?"calc(100% - 64px)":"auto"},children:p?(()=>{const e=window.innerHeight-180,t=(f.height?f.height>e?e:f.height:e)||e;return Object(R.jsx)(b.a,{container:!0,alignItems:"center",justifyContent:"center",sx:{height:t},children:Object(R.jsx)(b.a,{item:!0,alignItems:"center",sx:{position:"relative"},children:Object(R.jsx)(I,{})})})})():Object(R.jsx)(o.a,{ref:e=>Y.current.table=e,"aria-label":"caption table",size:T,stickyHeader:!0,children:ae})}),!p&&n.length>0&&Object(R.jsx)(N,{data:n,onPageChange:F,page:E,count:z,limit:W}),Object(R.jsx)(U.a,{className:"enhancedTable_dialog",open:y.open,config:y.config,onClose:ne})]})};t.a=Object(S.withRouter)(Object(v.memo)(T))},363:function(e,t,n){"use strict";function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return c}));const c=(e,t,n)=>(t!==n&&(Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(e,t)),delete e[t]),e)}}]);
//# sourceMappingURL=29.31c25322.chunk.js.map