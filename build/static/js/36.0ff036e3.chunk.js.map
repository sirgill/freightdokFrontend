{"version":3,"sources":["views/businessIntelligence/index.js","../node_modules/@mui/icons-material/Refresh.js","actions/businessIntelligence.action.js"],"names":["CardSection","lazy","BITabs","withRouter","props","canViewCards","UserSettings","getUserPermissionsByDashboardId","sun","moment","subtract","startOf","sat","endOf","isRefetching","useSelector","state","_","get","match","path","history","dispatch","useDispatch","dateRange","setDateRange","useState","startDate","Date","endDate","key","onChange","useCallback","_ref","value","fetchBI","utc","toISOString","useEffect","toDate","fetchBIData","getFinancialsTabData","refetch","arguments","length","undefined","getFinancials","fetchHistoricalTabData","startDate_2","endDate_2","startDate_3","endDate_3","getHistoricalPerformance","_jsxs","_Stack","sx","height","pt","gap","xs","md","overflow","className","children","_Box","textAlign","_jsx","DateRangePicker","label","pickerProps","maxDate","_IconButton","title","onClick","refresh","bind","_Refresh","Suspense","fallback","LoadingComponent","basePath","_interopRequireDefault","require","Object","defineProperty","exports","default","_createSvgIcon","_jsxRuntime","_default","jsx","d","options","isRefetch","async","type","IS_BI_REFETCHING","payload","IS_BI_LOADING","uri","concat","BUSINESS_INTELLIGENCE","serialize","data","success","requestGet","FETCH_BI","e","notification","message","dateArray","BI_HISTORICAL_PERFORMANCE_LOADING","promiseRequests","map","BUSINESS_INTELLIGENCE_HISTORICAL_PERFORMANCE","fetchHistoricalPerformance","wait","promise","Promise","all","error","response","i","BI_HISTORICAL_PERFORMANCE_ERROR","open","severity","BI_HISTORICAL_PERFORMANCE","err","console","log","BI_FINANCIAL_LOADING","BUSINESS_INTELLIGENCE_FINANCIALS","BI_FINANCIAL","BI_FINANCIAL_ERROR","closeBIAlert","Store"],"mappings":"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","file":"static/js/36.0ff036e3.chunk.js","sourcesContent":["import {Stack, Box, IconButton} from \"@mui/material\";\r\nimport React, {lazy, Suspense, useCallback, useEffect, useState} from \"react\";\r\nimport {withRouter} from 'react-router-dom';\r\nimport {DateRangePicker, LoadingComponent} from \"../../components/Atoms\";\r\nimport moment from \"moment\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport _ from \"lodash\";\r\nimport {fetchBI, getFinancials, getHistoricalPerformance} from \"../../actions/businessIntelligence.action\";\r\nimport {Refresh} from \"@mui/icons-material\";\r\nimport {UserSettings} from \"../../components/Atoms/client\";\r\n\r\nconst CardSection = lazy(() => import(\"./cardSection/CardSection\"));\r\nconst BITabs = lazy(() => import(\"./BIDashboardTabs/BITabs\"));\r\n\r\nconst BITab = (props) => {\r\n    const {canViewCards} = UserSettings.getUserPermissionsByDashboardId('businessIntelligence');\r\n    const sun = moment().subtract(1, 'weeks').startOf('week');\r\n    const sat = moment().subtract(1, 'weeks').endOf('week');\r\n    const isRefetching = useSelector(state => _.get(state, 'businessIntelligence.isRefetching', false));\r\n    const {match: {path = ''}, history} = props,\r\n        dispatch = useDispatch()\r\n    const [dateRange, setDateRange] = useState({\r\n        startDate: new Date(),\r\n        endDate: new Date(),\r\n        key: 'selection',\r\n    });\r\n\r\n    const onChange =  useCallback(({value}) => {\r\n        const {startDate, endDate} = value;\r\n            dispatch(fetchBI({startDate:moment(startDate).utc(true).toISOString(), endDate: moment(endDate).utc(true).toISOString()}, true ));\r\n            setDateRange({\r\n                ...dateRange,\r\n                startDate: new Date(startDate),\r\n                endDate: new Date(endDate)\r\n            })\r\n    }, [dateRange])\r\n\r\n    useEffect(() => {\r\n        setDateRange({\r\n            key: 'selection',\r\n            startDate: new Date(sun.toDate()),\r\n            endDate: new Date(sat.toDate())\r\n        })\r\n    }, [path, history]);\r\n\r\n    useEffect(() => {\r\n        fetchBIData();\r\n        getFinancialsTabData()\r\n    }, [dateRange]);\r\n\r\n    const fetchBIData = (refetch = false) => {\r\n        dispatch(fetchBI({startDate: sun.toISOString(), endDate: sat.toISOString()}, refetch ));\r\n    }\r\n\r\n    const getFinancialsTabData = () => {\r\n        dispatch(getFinancials({startDate: dateRange.startDate.toISOString(), endDate: dateRange.endDate.toISOString()}))\r\n    }\r\n\r\n    const fetchHistoricalTabData = useCallback(() => {\r\n        const startDate = moment().subtract(1, 'weeks').startOf('week');\r\n        const endDate = moment().subtract(1, 'weeks').endOf('week')\r\n\r\n        const startDate_2 = moment().subtract(2, 'weeks').startOf('week')\r\n        const endDate_2 = moment().subtract(2, 'weeks').endOf('week')\r\n\r\n        const startDate_3 = moment().subtract(3, 'weeks').startOf('week');\r\n        const endDate_3 = moment().subtract(3, 'weeks').endOf('week')\r\n        dispatch(getHistoricalPerformance([\r\n            {startDate, endDate},\r\n            {startDate: startDate_2, endDate: endDate_2},\r\n            {startDate: startDate_3, endDate: endDate_3}\r\n        ]))\r\n    }, [dispatch])\r\n\r\n    const onRefresh = (refresh = false) => {\r\n        fetchBIData(refresh);\r\n        fetchHistoricalTabData(refresh);\r\n        getFinancialsTabData(refresh);\r\n    }\r\n\r\n    return <Stack sx={{height: '100%', pt: 2, gap: {xs: 2, md: 4}, overflow: 'auto'}} className='dashboardRoot'>\r\n        {canViewCards && <Box sx={{textAlign: 'right'}}>\r\n            <DateRangePicker label='Date Range' value={dateRange} pickerProps={{maxDate: sat.toDate()}} onChange={onChange}/>\r\n            <IconButton title='Refresh' onClick={onRefresh.bind(null, true)}>\r\n                <Refresh className={(isRefetching) ? 'rotateIcon' : undefined}/>\r\n            </IconButton>\r\n        </Box>}\r\n        {canViewCards && <Suspense fallback={<LoadingComponent/>}>\r\n            <CardSection/>\r\n        </Suspense>}\r\n        <Suspense fallback={<LoadingComponent />}>\r\n            <BITabs\r\n                basePath={path}\r\n                dateRange={dateRange}\r\n                fetchHistoricalTabData={fetchHistoricalTabData}\r\n                getFinancialsTabData={getFinancialsTabData}\r\n            />\r\n        </Suspense>\r\n    </Stack>\r\n}\r\n\r\nexport default withRouter(BITab);","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z\"\n}), 'Refresh');\nexports.default = _default;","import {requestGet} from \"../utils/request\";\r\nimport {\r\n    BUSINESS_INTELLIGENCE,\r\n    BUSINESS_INTELLIGENCE_FINANCIALS,\r\n    BUSINESS_INTELLIGENCE_HISTORICAL_PERFORMANCE\r\n} from \"../config/requestEndpoints\";\r\nimport {serialize, wait} from \"../utils/utils\";\r\nimport {notification} from \"./alert\";\r\nimport {\r\n    IS_BI_LOADING,\r\n    FETCH_BI,\r\n    IS_BI_REFETCHING,\r\n    BI_HISTORICAL_PERFORMANCE,\r\n    BI_HISTORICAL_PERFORMANCE_LOADING,\r\n    BI_FINANCIAL_LOADING,\r\n    BI_FINANCIAL,\r\n    BI_FINANCIAL_ERROR,\r\n    BI_HISTORICAL_PERFORMANCE_ERROR\r\n} from \"./types\";\r\nimport Store from \"../store\";\r\n\r\nexport const fetchBI = (options, isRefetch) => async (dispatch) => {\r\n    try {\r\n        isRefetch ? dispatch({type: IS_BI_REFETCHING, payload: true}) : dispatch({type: IS_BI_LOADING, payload: true})\r\n        const uri = `${BUSINESS_INTELLIGENCE}?${serialize(options)}`\r\n        const {data, success} = await requestGet({uri});\r\n\r\n        dispatch({type: FETCH_BI, payload: {data, success}});\r\n        isRefetch ? dispatch({type: IS_BI_REFETCHING, payload: false}) : dispatch({type: IS_BI_LOADING, payload: false})\r\n    } catch (e) {\r\n        notification(e.message, 'error')\r\n        isRefetch ? dispatch({type: IS_BI_REFETCHING, payload: false}) : dispatch({type: IS_BI_LOADING, payload: false})\r\n    }\r\n}\r\n\r\nconst fetchHistoricalPerformance = async (options = {}) => {\r\n    const uri = `${BUSINESS_INTELLIGENCE_HISTORICAL_PERFORMANCE}?${serialize(options)}`\r\n    return requestGet({uri});\r\n}\r\n\r\nexport const getHistoricalPerformance = (dateArray) => async (dispatch) => {\r\n    try {\r\n        dispatch({type: BI_HISTORICAL_PERFORMANCE_LOADING, payload: true})\r\n        const promiseRequests = dateArray.map(async ({startDate, endDate}) => {\r\n            return fetchHistoricalPerformance({startDate: startDate.utc(true).toISOString(), endDate: endDate.utc(true).toISOString()})\r\n        })\r\n        await wait(2000);\r\n        const promise = await Promise.all(promiseRequests);\r\n        let error = false;\r\n        const data = promise.map((response, i) => {\r\n            const {success, data} = response;\r\n            if(success && data) {\r\n                return {\r\n                    data,\r\n                    dateRange: dateArray[i]\r\n                };\r\n            } else {\r\n                error = true\r\n            }\r\n        })\r\n        if(error) {\r\n            dispatch({ type: BI_HISTORICAL_PERFORMANCE_ERROR, payload: {open: true, message: 'No data found', severity: 'error'} })\r\n        }\r\n        else dispatch({ type: BI_HISTORICAL_PERFORMANCE, payload: data })\r\n    } catch (e) {\r\n        dispatch({ type: BI_HISTORICAL_PERFORMANCE_ERROR, payload: {open: true, message: e.err || \"Error getting data\", severity: 'error'} })\r\n        console.log(e)\r\n    }\r\n    finally {\r\n        dispatch({type: BI_HISTORICAL_PERFORMANCE_LOADING, payload: false})\r\n    }\r\n}\r\n\r\nexport const getFinancials = (options) => async(dispatch) => {\r\n    try{\r\n        dispatch({type: BI_FINANCIAL_LOADING, payload: true});\r\n        const {success, data} = await requestGet({uri: BUSINESS_INTELLIGENCE_FINANCIALS + `?${serialize(options)}`});\r\n        if(success){\r\n            dispatch({type: BI_FINANCIAL, payload: data})\r\n        } else {\r\n            dispatch({type: BI_FINANCIAL_ERROR, payload: {open: true, message: data.message || \"Error getting data\", severity: 'error'} })\r\n            dispatch({type: BI_FINANCIAL_LOADING, payload: false});\r\n        }\r\n    } catch (e) {\r\n        dispatch({type: BI_FINANCIAL_ERROR, payload: {open: true, message: e.error || \"Error getting results\", severity: 'error'}})\r\n        dispatch({type: BI_FINANCIAL_LOADING, payload: false});\r\n    }\r\n    finally {\r\n        dispatch({type: BI_FINANCIAL_LOADING, payload: false});\r\n    }\r\n}\r\n\r\nexport const closeBIAlert = (type = BI_FINANCIAL_ERROR) => {\r\n    Store.dispatch({type, payload: {open: false, message: null, severity: 'error'}})\r\n}\r\n\r\n"],"sourceRoot":""}